import streamlit as st
import pandas as pd
import numpy as np

# è®¾ç½®é¡µé¢é…ç½®
st.set_page_config(page_title="å—å®ç¾é£Ÿä»ªè¡¨ç›˜", page_icon="ğŸœ", layout="wide")

# ----------------------
# åŸºç¡€æ•°æ®ï¼ˆè…¾è®¯åæ ‡ï¼‰
# ----------------------
# 1. é¤å…åŸºç¡€ä¿¡æ¯ï¼ˆ5å®¶+çœŸå®è…¾è®¯åæ ‡ï¼‰
restaurants_data = {
    "é¤å…": ["æ˜Ÿè‰ºä¼šå°ä¸å¿˜", "é«˜å³°æŸ æª¬é¸­", "å¤è®°è€å‹ç²‰", "å¥½å‹ç¼˜", "è¥¿å†·ç‰›æ’åº—"],
    "ç±»å‹": ["ä¸­é¤", "ä¸­é¤", "å¿«é¤", "è‡ªåŠ©é¤", "è¥¿é¤"],
    "è¯„åˆ†": [4.2, 4.5, 4.0, 4.7, 4.3],
    "äººå‡æ¶ˆè´¹(å…ƒ)": [15, 20, 25, 35, 50],
    "latitude": [22.853838, 22.965046, 22.812200, 22.809105, 22.839699],
    "longitude": [108.222177, 108.353921, 108.266629, 108.378664, 108.245804]
}

# 2. 5å®¶é¤å…12ä¸ªæœˆä»·æ ¼èµ°åŠ¿æ•°æ®
months = ["1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ", "5æœˆ", "6æœˆ", "7æœˆ", "8æœˆ", "9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ"]
price_trend_data = {
    "æœˆä»½": months * 5,
    "é¤å…": ["æ˜Ÿè‰ºä¼šå°ä¸å¿˜"]*12 + ["é«˜å³°æŸ æª¬é¸­"]*12 + ["å¤è®°è€å‹ç²‰"]*12 + ["å¥½å‹ç¼˜"]*12 + ["è¥¿å†·ç‰›æ’åº—"]*12,
    "ä»·æ ¼(å…ƒ)": [
        14,14,15,15,15,16,16,15,15,15,14,14,  # æ˜Ÿè‰ºä¼šå°ä¸å¿˜
        19,19,20,20,21,21,21,20,20,20,19,19,  # é«˜å³°æŸ æª¬é¸­
        24,24,25,25,26,26,26,25,25,25,24,24,  # å¤è®°è€å‹ç²‰
        34,34,35,36,36,37,37,36,35,35,34,34,  # å¥½å‹ç¼˜
        48,49,50,50,51,51,52,51,50,50,49,48   # è¥¿å†·ç‰›æ’åº—
    ]
}

# 3. èœå“é”€é‡æ•°æ®ï¼ˆç”¨äºæŸ±çŠ¶å›¾ï¼‰
sales_data = {
    "èœå“": ["è€å‹ç²‰", "æŸ æª¬é¸­", "ç²‰é¥º", "ç‰›æ‚", "ç‰›æ’"],
    "æœˆé”€é‡(ä»½)": [8500, 6200, 4800, 5500, 3200]
}

# 4. æ¶ˆè´¹å æ¯”æ•°æ®ï¼ˆç”¨äºé¢ç§¯å›¾ï¼‰
area_data = {
    "æœˆä»½": months,
    "ä¸­é¤æ¶ˆè´¹": [18,19,20,21,22,23,22,21,20,19,18,17],
    "å¿«é¤æ¶ˆè´¹": [15,16,17,18,18,19,18,17,16,15,14,14],
    "è¥¿é¤æ¶ˆè´¹": [25,26,27,28,29,30,29,28,27,26,25,24]
}

# è½¬æ¢ä¸ºDataFrame
df_restaurants = pd.DataFrame(restaurants_data)
df_price = pd.DataFrame(price_trend_data)
df_sales = pd.DataFrame(sales_data)
df_area = pd.DataFrame(area_data)

# ----------------------
# é¡µé¢å¸ƒå±€
# ----------------------
# æ ‡é¢˜
st.title("ğŸœ å—å®ç¾é£Ÿæ•°æ®ä»ªè¡¨ç›˜")
st.divider()

# ç¬¬ä¸€è¡Œï¼šæ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡
col1, col2, col3 = st.columns(3)
with col1:
    st.metric("é¤å…æ€»æ•°", value=len(df_restaurants))
with col2:
    st.metric("å¹³å‡è¯„åˆ†", value=f"{df_restaurants['è¯„åˆ†'].mean():.1f}")
with col3:
    st.metric("å¹³å‡äººå‡æ¶ˆè´¹", value=f"Â¥{df_restaurants['äººå‡æ¶ˆè´¹(å…ƒ)'].mean():.0f}")

st.divider()

# ç¬¬äºŒè¡Œï¼šæŠ˜çº¿å›¾ï¼ˆä»·æ ¼èµ°åŠ¿ï¼‰+ æŸ±çŠ¶å›¾ï¼ˆé”€é‡ï¼‰
col1, col2 = st.columns(2)

with col1:
    st.subheader("ğŸ“ˆ 12ä¸ªæœˆä»·æ ¼èµ°åŠ¿")
    # é‡å¡‘ä»·æ ¼æ•°æ®ç”¨äºæŠ˜çº¿å›¾
    price_pivot = df_price.pivot(index="æœˆä»½", columns="é¤å…", values="ä»·æ ¼(å…ƒ)")
    st.line_chart(price_pivot, height=300)

with col2:
    st.subheader("ğŸ“Š ç‰¹è‰²èœå“æœˆé”€é‡")
    st.bar_chart(df_sales.set_index("èœå“"), height=300)

st.divider()

# ç¬¬ä¸‰è¡Œï¼šé¢ç§¯å›¾ + åœ°å›¾
col1, col2 = st.columns(2)

with col1:
    st.subheader("ğŸ’° æ¶ˆè´¹ç±»å‹è¶‹åŠ¿")
    st.area_chart(df_area.set_index("æœˆä»½"), height=300)

with col2:
    st.subheader("ğŸ“ é¤å…ä½ç½®åˆ†å¸ƒ")
    # åœ°å›¾å±•ç¤ºï¼ˆè…¾è®¯åæ ‡é€‚é…ï¼‰
    st.map(df_restaurants[["latitude", "longitude"]], 
           zoom=11, 
           use_container_width=True,
           height=300)

st.divider()
